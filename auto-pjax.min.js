/*
 * auto-pjax.js 0.1.3
 *
 * Copyright (c) 2017 Guilherme Nascimento (brcontainer@yahoo.com.br)
 *
 * Released under the MIT license
 */

!function(t,e,a){"use strict";function o(t){return/^\d+$/.test(t)}function r(){x&&clearTimeout(x),j||(j=a('<div class="pjax-loader pjax-hide"><div class="pjax-progress"></div></div>'),j.insertBefore("body")),j.removeClass("pjax-hide"),j.removeClass("pjax-end"),j.addClass("pjax-start"),x=setTimeout(function(){j.addClass("pjax-inload")},10)}function n(){x&&clearTimeout(x),j.addClass("pjax-end"),x=setTimeout(function(){j.removeClass("pjax-inload"),j.addClass("pjax-hide")},1e3)}function i(e){var o,r,n=[];a("*",e).each(function(){"TITLE"!==this.tagName&&n.push(this.outerHTML)}),a("*",t.head).each(function(){"TITLE"!==this.tagName&&(o=this.outerHTML,r=n.indexOf(o),-1===r?a(this).remove():n.splice(r,1))});for(var i=0,s=n.length;s>i;i++)a(n[i]).appendTo("head")}function s(t){for(var e,o,r,n=a.extend(f,{}),i=["selectors","updatehead","loader","scroll-left","scroll-right"],s=i.length-1;s>=0;s--)e=i[s],r=t.data("pjax-"+e),r&&(o=e.toLowerCase().replace(/\-([a-z])/g,function(t,e){return e.toUpperCase()}),n[o]=r);return n}function l(t,r,n,s){var l=(new DOMParser).parseFromString(r,"text/html"),p=l.title||"",c=n.selectors;if(s){var d={pjaxUrl:t,pjaxData:r,pjaxConfig:n};1===s?e.history.pushState(d,p,t.substring(m.length)):e.history.replaceState(d,p,t.substring(m.length))}f.updatehead&&i(l.head),n.title&&(g.title=p);for(var u=0,h=c.length;h>u;u++)a(c[u]).html(a(c[u],l.body).html()||"");o(n.scrollLeft)&&g.scrollLeft(n.scrollLeft),o(n.scrollTop)&&g.scrollTop(n.scrollTop),l=c=null}function p(){h&&h.abort()}function c(t,e,o,r,n,i){p();var c=s(a(r));g.trigger("pjax.initiate",[t,c]);var d={dataType:"text",headers:{"X-PJAX-Container":c.selectors.join(","),"X-PJAX-URL":t,"X-PJAX":"true"}};o&&n&&(d.data=n,d.type=o,i&&(d.processData=!1)),d.url=t,h=a.ajax(d).done(function(a){l(t,a,c,e),g.trigger("pjax.done",[t]),g.trigger("pjax.then",[t])}).fail(function(e,a,o){g.trigger("pjax.fail",[t,a,o]),g.trigger("pjax.then",[t])})}function d(t){var o,r,n=!1,i="FORM"===this.nodeName?this.action:this.href;if(0===i.indexOf(m)){if("FORM"===this.nodeName){if(o=String(this.method).toUpperCase(),"POST"===o&&!e.FormData)return;if("POST"!==o||"multipart/form-data"!==this.enctype)r=a(this).serialize(),"POST"!==o&&(i=i.replace(/\?.*/g,""),r&&(i+="?"+r),r=null);else{if(!e.FormData)return;r=new FormData(this),n=!0}}return t.preventDefault(),i===String(e.location)&&"POST"!==o?!1:(c(i,1,o,this,r,n),!1)}}function u(t){t.state&&t.state.pjaxUrl?(p(),l(t.state.pjaxUrl,t.state.pjaxData,t.state.pjaxConfig,!1)):c(String(e.location),2)}if(!e.history.pushState||!e.DOMParser||!/^http(|s):$/.test(e.location.protocol))return void(a.autoPjax=function(){});var f,h,x,j,g=a(t),m=e.location.protocol.replace(/:/g,"")+"://"+e.location.host;a.autoPjax=function(o){var i=":not([data-pjax-ignore]):not([action^='javascript:'])",s=":not([data-pjax-ignore]):not([href^='#']):not([href^='javascript:'])";if("remove"===o){if(!f)return;return f.load&&(g.off("pjax.initiate",r),g.off("pjax.then",n)),g.off("submit","form"+i,d),g.off("click","a"+s,d),e.removeEventListener("unload",p),void e.removeEventListener("popstate",u)}f=a.extend({selectors:["#pjax-container"],updatehead:!0,scrollLeft:0,scrollTop:0,loader:!0},o),f.loader&&(g.on("pjax.initiate",r),g.on("pjax.then",n)),g.on("submit","form"+i,d),g.on("click","a"+s,d);var l=String(e.location);e.addEventListener("unload",p),e.addEventListener("popstate",u),a(function(){e.history.replaceState({pjaxUrl:l,pjaxData:t.documentElement.outerHTML,pjaxConfig:f},t.title,l.substring(m.length))})}}(document,window,window.jQuery);
