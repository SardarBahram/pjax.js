/* auto-pjax.js 0.2.0 | Copyright (c) 2017 Guilherme Nascimento (brcontainer@yahoo.com.br) | Released under the MIT license */
!function(t,e,a,o){"use strict";function n(t){return/^\d+$/.test(t)}function r(){j&&clearTimeout(j),g||(g=a('<div class="pjax-loader pjax-hide"><div class="pjax-progress"></div></div>'),g.insertBefore("body")),g.removeClass("pjax-hide"),g.removeClass("pjax-end"),g.addClass("pjax-start"),j=setTimeout(function(){g.addClass("pjax-inload")},10)}function i(){j&&clearTimeout(j),g.addClass("pjax-end"),j=setTimeout(function(){g.removeClass("pjax-inload"),g.addClass("pjax-hide")},1e3)}function s(e){var o,n,r=[];a("*",e).each(function(){"TITLE"!==this.tagName&&r.push(this.outerHTML)}),a("*",t.head).each(function(){"TITLE"!==this.tagName&&(o=this.outerHTML,n=r.indexOf(o),-1===n?a(this).remove():r.splice(n,1))});for(var i=0,s=r.length;s>i;i++)a(r[i]).appendTo("head")}function l(t){for(var e,o,n,r=a.extend(h,{}),i=["containers","updatehead","loader","scroll-left","scroll-right"],s=i.length-1;s>=0;s--)e=i[s],n=t.data("pjax-"+e),n&&(o=e.toLowerCase().replace(/\-([a-z])/g,function(t,e){return e.toUpperCase()}),r[o]=n);return r}function p(t,o,r,i){var l=(new DOMParser).parseFromString(o,"text/html"),p=l.title||"",c=r.containers;if(i){var d={pjaxUrl:t,pjaxData:o,pjaxConfig:r};1===i?e.history.pushState(d,p,t.substring(v.length)):e.history.replaceState(d,p,t.substring(v.length))}h.updatehead&&s(l.head),r.title&&(m.title=p);for(var u=0,f=c.length;f>u;u++)a(c[u]).html(a(c[u],l.body).html()||"");n(r.scrollLeft)&&m.scrollLeft(r.scrollLeft),n(r.scrollTop)&&m.scrollTop(r.scrollTop),l=c=null}function c(){x&&x.abort()}function d(t,e,o,n,r,i){c();var s=l(a(n));m.trigger("pjax.initiate",[t,s]);var d={dataType:"text",headers:{"X-PJAX-Container":s.containers.join(","),"X-PJAX-URL":t,"X-PJAX":"true"}};o&&r&&(d.data=r,d.type=o,i&&(d.processData=!1)),d.url=t,x=a.ajax(d).done(function(a){p(t,a,s,e),m.trigger("pjax.done",[t]),m.trigger("pjax.then",[t])}).fail(function(e,a,o){m.trigger("pjax.fail",[t,a,o]),m.trigger("pjax.then",[t])})}function u(t){var o,n,r=!1,i="FORM"===this.nodeName?this.action:this.href;if(0===i.indexOf(v)){if("FORM"===this.nodeName){if(o=String(this.method).toUpperCase(),"POST"===o&&!e.FormData)return;if("POST"!==o||"multipart/form-data"!==this.enctype)n=a(this).serialize(),"POST"!==o&&(i=i.replace(/\?.*/g,""),n&&(i+="?"+n),n=null);else{if(!e.FormData)return;n=new FormData(this),r=!0}}return t.preventDefault(),i===String(e.location)&&"POST"!==o?!1:(d(i,1,o,this,n,r),!1)}}function f(t){t.state&&t.state.pjaxUrl?(c(),p(t.state.pjaxUrl,t.state.pjaxData,t.state.pjaxConfig,!1)):d(String(e.location),2)}if(!e.history.pushState||!e.DOMParser||!/^http(|s):$/.test(e.location.protocol))return void(a.autoPjax=function(){});var h,x,j,g,m=a(t),v=e.location.protocol.replace(/:/g,"")+"://"+e.location.host;a.autoPjax=function(n){var s=":not([data-pjax-ignore]):not([action^='javascript:'])",l=":not([data-pjax-ignore]):not([href^='#']):not([href^='javascript:'])";if("remove"===n){if(!h)return;return h.load&&(m.off("pjax.initiate",r),m.off("pjax.then",i)),m.off("submit","form"+s,u),m.off("click","a"+l,u),e.removeEventListener("unload",c),e.removeEventListener("popstate",f),void(h=o)}h=a.extend({containers:["#pjax-container"],updatehead:!0,scrollLeft:0,scrollTop:0,loader:!0},n),h.loader&&(m.on("pjax.initiate",r),m.on("pjax.then",i)),m.on("submit","form"+s,u),m.on("click","a"+l,u),e.addEventListener("unload",c),e.addEventListener("popstate",f),a(function(){var a=String(e.location);e.history.replaceState({pjaxUrl:a,pjaxData:t.documentElement.outerHTML,pjaxConfig:h},t.title,a.substring(v.length))})}}(document,window,window.jQuery);
