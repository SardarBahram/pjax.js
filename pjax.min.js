/* Pjax.js 0.3.0 | Copyright (c) 2017 Guilherme Nascimento (brcontainer@yahoo.com.br) | Released under the MIT license */

!function(e,t,n,r){"use strict";function a(e){return/^\d+$/.test(e)}function o(){O&&clearTimeout(O),D||(D=e.createElement("div"),D.className="pjax-loader pjax-hide",D.innerHTML='<div class="pjax-progress"></div>',e.body.appendChild(D)),D.classList.remove("pjax-hide"),D.classList.remove("pjax-end"),D.classList.add("pjax-start"),O=setTimeout(function(){D.classList.add("pjax-inload")},10)}function i(){O&&clearTimeout(O),D.classList.add("pjax-end"),O=setTimeout(function(){D.classList.remove("pjax-inload"),D.classList.add("pjax-hide")},1e3)}function l(e){var t=[];return[].slice.call(e.querySelectorAll("[name]")).forEach(function(e){e.name&&b.test(e.taName)&&t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))}),t.join("&")}function s(t){if(DOMParser)return(new DOMParser).parseFromString(t,"text/html");var n=e.implementation.createHTMLDocument("");return-1!==t.toLowerCase().indexOf("<!doctype")?n.documentElement.innerHTML=t:n.body.innerHTML=t,n}function c(t){var n,r,a,o=[],i=t.childNodes;for(n=i.length-1;n>=0;n--)"TITLE"!==i[n].tagName&&o.push(i[n].outerHTML);for(i=e.head.childNodes,n=i.length-1;n>=0;n--)"TITLE"!==i[n].tagName&&(r=o.indexOf(i[n].outerHTML),-1===r?i[n].parentNode.removeChild(i[n]):o.splice(r,1));for(a=e.createElement("div"),a.innerHTML=o.join(""),i=a.childNodes,n=i.length-1;n>=0;n--)e.head.appendChild(i[n]);a=o=null}function u(e,t,n,r){if(N[e])for(var a=N[e],o=0;o<a.length;o++)a[o](t,n,r)}function d(e,t,n){if("function"==typeof t){N[e]||(N[e]=[]);var r=N[e];if(!n)return void r.push(t);for(var a=[],o=r.length-1;o>=0;o--)r[o]===t&&a.push(o);for(var o=a.length-1;o>=0;o--)r.splice(a[o],1)}}function f(n,r,o,i){var l,u=s(r),d=u.title||"",f=o.containers,p=a(o.scrollLeft)?o.scrollLeft:t.scrollX||t.pageXOffset,h=a(o.scrollTop)?o.scrollTop:t.scrollY||t.pageYOffset;if(i){var m={pjaxUrl:n,pjaxData:r,pjaxConfig:o};1===i?t.history.pushState(m,d,n.substring(C.length)):2===i&&t.history.replaceState(m,d,n.substring(C.length))}E.updatehead&&c(u.head),d&&(e.title=d);for(var v=0,g=f.length;g>v;v++)for(var L=e.querySelectorAll(f[v]),p=0,S=L.length;S>p;p++)l=u.body.querySelector(f[v]),l&&(L[0].innerHTML=l.innerHTML);t.scrollTo(p,h),u=f=null}function p(e,t){var n,r=e.getAttribute(t);if("true"===r||"false"===r)n="true"===r;else if(/^\[*.?\]$|^\{*.?\}$/.test(r))try{n=JSON.parse(r)}catch(a){}return n||r}function h(e){for(var t,n,r,a=JSON.parse(JSON.stringify(E)),o=["containers","updatecurrent","updatehead","loader","scroll-left","scroll-right","then","done","fail"],i=o.length-1;i>=0;i--)t=o[i],r=p(e,"pjax-"+t),r&&(n=t.toLowerCase().replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()}),a[n]=r);return a}function m(e,t,n,r){f(e,t,n,r),u("done",e),u("then",e)}function v(e,t){u("fail",e,t),u("then",e)}function g(){M&&M.abort()}function L(e,t,n,r,a){g();var o=h(r);if(u("initiate",e,o),N.handler)return void u("handler",{url:e,state:t,method:n,element:r,containers:o.containers},m,v);var i={"X-PJAX-Container":o.containers.join(","),"X-PJAX-URL":e,"X-PJAX":"true"};M=new XMLHttpRequest,M.open(n,E.proxy||e,!0);for(var l in i)M.setRequestHeader(l,i[l]);M.onreadystatechange=function(){if(4===this.readyState){var n=this.status;n>=200&&300>n||304===n?(m(e,this.responseText,o,t),u("done",e)):v(e,n)}},M.send(a||"")}function S(e){var n,r,a="GET",o=null,i=e.target;if(i.matches(E.formSelector))n=i.action;else if(i.matches(E.linkSelector))n=i.href;else{for(e.preventDefault();i.parentNode;){i=i.parentNode,"A"===i.tagName&&(r=i);break}if(!r||!r.matches(E.linkSelector))return;i=r,n=i.href}if(0===n.indexOf(C+"/")||n===C){if("FORM"===i.nodeName){if(a=String(i.method).toUpperCase(),"POST"===a&&!FormData)return;if("POST"!==a||"multipart/form-data"!==i.enctype)o=l(i),"POST"!==a&&(n=n.replace(/\?.*/g,""),o&&(n+="?"+o),o=null);else{if(!FormData)return;o=new FormData(i)}}return e.preventDefault(),n===String(t.location)&&"POST"!==a?(E.updatecurrent&&L(n,2,a,i,o),!1):(L(n,1,a,i,o),!1)}}function x(e){e.state&&e.state.pjaxUrl?(g(),f(e.state.pjaxUrl,e.state.pjaxData,e.state.pjaxConfig,!1)):L(String(t.location),2)}function j(){var n=String(t.location);t.history.replaceState({pjaxUrl:n,pjaxData:e.documentElement.outerHTML,pjaxConfig:E},e.title,n.substring(C.length))}function T(){E&&(E.load&&(d("initiate",o,!0),d("then",i,!0)),e.removeEventListener("click",S),e.removeEventListener("submit",S),t.removeEventListener("unload",g),t.removeEventListener("popstate",x))}function y(n){if(/^http(|s):$/.test(t.location.protocol)){T(),E={linkSelector:"a:not([data-pjax-ignore]):not([href^='#']):not([href^='javascript:'])",formSelector:"form:not([data-pjax-ignore]):not([action^='javascript:'])",containers:["#pjax-container"],updatecurrent:!1,updatehead:!0,scrollLeft:0,scrollTop:0,loader:!0,proxy:""};for(var r in E)n&&n[r]&&(E[r]=n[r]);n=null,d("initiate",o),d("then",i),t.addEventListener("unload",g),t.addEventListener("popstate",x),E.linkSelector&&e.addEventListener("click",S),E.formSelector&&e.addEventListener("submit",S),/^(interactive|complete)$/i.test(e.readyState)?j():e.addEventListener("DOMContentLoaded",j)}}t.Pjax={supported:!history.pushState||!(DOMParser||e.implementation.createHTMLDocument),remove:T,start:y,on:function(e,t){d(e,t)},off:function(e,t){d(e,t,!0)}};var M,E,O,D,N={},C=t.location.protocol.replace(/:/g,"")+"://"+t.location.host,b=/^(input|textarea|select|datalist|button|output)$/i;n.matches||(n.matches=n.matchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t[n]!==this;);return n>-1})}(document,window,Element&&Element.prototype);
